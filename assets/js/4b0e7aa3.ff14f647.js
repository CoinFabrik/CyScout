"use strict";(self.webpackChunkcodeql_research=self.webpackChunkcodeql_research||[]).push([[568],{484:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>n,metadata:()=>d,toc:()=>c});var s=i(6070),o=i(1503);const n={},r="CyScout",d={id:"README/readme",title:"CyScout",description:"Run queries and detect vulnerabilities in your smart contracts using CodeQL-Solidity",source:"@site/docs/README/readme.md",sourceDirName:"README",slug:"/README/",permalink:"/CyScout/docs/README/",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/README/readme.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Unrpotected self destruct",permalink:"/CyScout/docs/Detectors/unprotected-self-destruct"},next:{title:"det01_doc",permalink:"/CyScout/docs/README/det01_doc"}},l={},c=[{value:"Run queries and detect vulnerabilities in your smart contracts using CodeQL-Solidity",id:"run-queries-and-detect-vulnerabilities-in-your-smart-contracts-using-codeql-solidity",level:2},{value:"\ud83d\udd0d Overview",id:"-overview",level:2},{value:"\ud83d\ude80 Project Status",id:"-project-status",level:2},{value:"\ud83c\udfc1 Getting Started",id:"-getting-started",level:2},{value:"1\ufe0f\u20e3 Install CodeQL CLI",id:"1\ufe0f\u20e3-install-codeql-cli",level:3},{value:"Clone CodeQL repository",id:"clone-codeql-repository",level:3},{value:"2\ufe0f\u20e3 Setting up Solidity Extractor",id:"2\ufe0f\u20e3-setting-up-solidity-extractor",level:3},{value:"3\ufe0f\u20e3 Extract Solidity Code",id:"3\ufe0f\u20e3-extract-solidity-code",level:3},{value:"4\ufe0f\u20e3 Run Sample Detectors",id:"4\ufe0f\u20e3-run-sample-detectors",level:3},{value:"Detectors",id:"detectors",level:2},{value:"Further Documentation",id:"further-documentation",level:3},{value:"\ud83e\udd1d Contributing",id:"-contributing",level:2},{value:"License",id:"license",level:2}];function a(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"cyscout",children:"CyScout"})}),"\n",(0,s.jsx)(t.h2,{id:"run-queries-and-detect-vulnerabilities-in-your-smart-contracts-using-codeql-solidity",children:"Run queries and detect vulnerabilities in your smart contracts using CodeQL-Solidity"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"alt text",src:i(7226).A+"",width:"378",height:"177"})}),"\n",(0,s.jsx)(t.p,{children:"This repository contains CoinFabrik's ongoing research and development to extend CodeQL support to the Solidity smart contract language. By leveraging the foundational work done by the CodeQL team for Ruby, we have adapted and expanded their approach to create a powerful toolset for analyzing Solidity code."}),"\n",(0,s.jsx)(t.h2,{id:"-overview",children:"\ud83d\udd0d Overview"}),"\n",(0,s.jsxs)(t.p,{children:["Our goal is to provide a comprehensive set of tools for querying and detecting vulnerabilities in Solidity smart contracts. We build upon the work of ",(0,s.jsx)(t.a,{href:"https://github.com/JoranHonig/tree-sitter-solidity",children:"Joran Honig's Solidity Tree-sitter grammar"})," and the CodeQL team's ",(0,s.jsx)(t.a,{href:"https://github.blog/security/web-application-security/code-scanning-and-ruby-turning-source-code-into-a-queryable-database/",children:"Ruby implementation"}),". The project includes an extractor, database schema generation, and abstractions such as a cleaner Abstract Syntax Tree (AST), Control Flow Graph (CFG), and Dataflow analysis. These elements enable complex vulnerability detection and querying, similar to the C++ libraries in CodeQL."]}),"\n",(0,s.jsx)(t.h2,{id:"-project-status",children:"\ud83d\ude80 Project Status"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Extractor and Database Schema"}),": Usable and functional for Solidity codebases."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Current Work"}),": We are actively developing a cleaner AST, CFG, and Dataflow support to enhance the detection of vulnerabilities."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Proof of Concept (PoC)"}),": Three simple detector examples are provided to demonstrate basic usage and potential."]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"-getting-started",children:"\ud83c\udfc1 Getting Started"}),"\n",(0,s.jsx)(t.p,{children:"To get started with analyzing Solidity smart contracts using CodeQL, follow these steps:"}),"\n",(0,s.jsx)(t.h3,{id:"1\ufe0f\u20e3-install-codeql-cli",children:"1\ufe0f\u20e3 Install CodeQL CLI"}),"\n",(0,s.jsxs)(t.p,{children:["First, download and install the CodeQL CLI by following the instructions provided in the ",(0,s.jsx)(t.a,{href:"https://github.com/github/codeql-cli-binaries",children:"official CodeQL CLI repository"}),"."]}),"\n",(0,s.jsx)(t.h3,{id:"clone-codeql-repository",children:"Clone CodeQL repository"}),"\n",(0,s.jsxs)(t.p,{children:["Clone this repository from ",(0,s.jsx)(t.a,{href:"https://github.com/github/codeql",children:"CodeQl"})]}),"\n",(0,s.jsx)(t.h3,{id:"2\ufe0f\u20e3-setting-up-solidity-extractor",children:"2\ufe0f\u20e3 Setting up Solidity Extractor"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["Go to ",(0,s.jsx)(t.code,{children:"codeql-research/solidity/extractor-pack/tools"})," and give all ",(0,s.jsx)(t.code,{children:".sh"})," files execute permissions. This is:"]}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"chmod +x *.sh\n"})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Copy the ",(0,s.jsx)(t.code,{children:"solidity"})," and ",(0,s.jsx)(t.code,{children:"solidity-test"})," folders of this repository (",(0,s.jsx)(t.code,{children:"codeql-research"}),") inside ",(0,s.jsx)(t.code,{children:"CodeQL CLI repository"})," and ",(0,s.jsx)(t.code,{children:"CodeQL"}),". Both at root level."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Inside ",(0,s.jsx)(t.code,{children:"CodeQL"})," repository, in this path ",(0,s.jsx)(t.code,{children:"codeql/solidity"})," run:"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-shell",children:"bash scripts/create-extractor-pack.sh\n"})}),"\n",(0,s.jsx)(t.p,{children:"--\x3e"}),"\n",(0,s.jsx)(t.h3,{id:"3\ufe0f\u20e3-extract-solidity-code",children:"3\ufe0f\u20e3 Extract Solidity Code"}),"\n",(0,s.jsx)(t.p,{children:"To create a CodeQL database from a Solidity codebase, run the following command:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-shell",children:"codeql database create /path-to-database/ -l solidity -s /path-to-solidity-codebase/ --search-path /path-to-[solidity/extractor-pack]/\n"})}),"\n",(0,s.jsx)(t.p,{children:"If all went smoothly, you should see something of the kind:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-shell",children:"\ncodeql database create /home/user/codeql/solidity-test/test-db-bitshift-examples -l solidity -s /home/user/codeql/solidity-test/bitshift-order-test --search-path ../solidity/extractor-pack --overwrite\nInitializing database at /home/user/codeql/solidity-test/test-db-bitshift-examples.\nRunning build command: []\nRunning command in /home/user/codeql/solidity-test/bitshift-order-test: [/home/user/codeql/solidity/extractor-pack/tools/autobuild.sh]\n[2024-09-03 12:55:56] [build-stderr] Scanning for files in /home/user/codeql/solidity-test/bitshift-order-test...\n[2024-09-03 12:55:56] [build-stderr] /home/user/codeql/solidity-test/test-db-bitshift-examples: Indexing files in in /home/user/codeql/solidity-test/bitshift-order-test...\n[2024-09-03 12:55:56] [build-stderr] Running command in /home/user/codeql/solidity-test/bitshift-order-test: [/home/user/codeql/solidity/extractor-pack/tools/index-files.sh, /home/user/codeql/solidity-test/test-db-bitshift-examples/working/files-to-index13975833793457248559.list]\n[2024-09-03 12:55:56] [build-stdout] [2024-09-03 12:55:56] [build-stdout]  INFO Extraction started\n[2024-09-03 12:55:56] [build-stdout] [2024-09-03 12:55:56] [build-stdout]  INFO Using 7 threads\n[2024-09-03 12:55:56] [build-stdout] [2024-09-03 12:55:56] [build-stdout]  INFO extracting: /home/user/codeql/solidity-test/bitshift-order-test/remediated.sol\n[2024-09-03 12:55:56] [build-stdout] [2024-09-03 12:55:56] [build-stdout]  INFO extracting: /home/user/codeql/solidity-test/bitshift-order-test/vulnerable.sol\n[2024-09-03 12:55:56] [build-stdout] [2024-09-03 12:55:56] [build-stdout]  INFO Extraction complete\nFinalizing database at /home/user/codeql/solidity-test/test-db-bitshift-examples.\nRunning TRAP import for CodeQL database at /home/user/codeql/solidity-test/test-db-bitshift-examples...\nImporting TRAP files\nMerging relations\nFinished writing database (relations: 4.86 KiB; string pool: 2.05 MiB).\nTRAP import complete (983ms).\nFinished zipping source archive (643.00 B).\nSuccessfully created database at /home/user/codeql/solidity-test/test-db-bitshift-examples.\n\n"})}),"\n",(0,s.jsx)(t.h3,{id:"4\ufe0f\u20e3-run-sample-detectors",children:"4\ufe0f\u20e3 Run Sample Detectors"}),"\n",(0,s.jsx)(t.p,{children:"Once the database is created, you can run sample detectors written in the QL language:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"codeql query run /path-to-detector/ -d /path-to-created-database/\n"})}),"\n",(0,s.jsx)(t.p,{children:"For instance:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-shell",children:"[1/1] Found in cache: /home/user/codeql/solidity/ql/lib/detector3.ql.\ndetector3.ql: Evaluation completed (191ms).\n|      col0       |                                     col1                                     |\n+-----------------+------------------------------------------------------------------------------+\n| YulFunctionCall | /home/user/codeql/solidity-test/bitshift-order-test/vulnerable.sol@4:18:4:26 |\nShutting down query evaluator.\n"})}),"\n",(0,s.jsx)(t.h2,{id:"detectors",children:"Detectors"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Num"}),(0,s.jsx)(t.th,{children:"Detector"}),(0,s.jsx)(t.th,{children:"What it Detects"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"1"}),(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"detector1"})}),(0,s.jsx)(t.td,{children:(0,s.jsxs)(t.a,{href:"/CyScout/docs/README/det01_doc",children:["transferFrom uses arbitrary ",(0,s.jsx)(t.code,{children:"from"})]})})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"2"}),(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"detector2"})}),(0,s.jsx)(t.td,{children:(0,s.jsx)(t.a,{href:"/CyScout/docs/README/det02_doc",children:"usage of the word 'FIX' in comments"})})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"3"}),(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"detector3"})}),(0,s.jsx)(t.td,{children:(0,s.jsx)(t.a,{href:"/CyScout/docs/README/det03_doc",children:"incorrect order of arguments in bit shift operations"})})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"4"}),(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"detector3"})}),(0,s.jsx)(t.td,{children:(0,s.jsx)(t.a,{href:"/CyScout/docs/README/det03_doc",children:"Dead code: unreachable basic blocks"})})]})]})]}),"\n",(0,s.jsx)(t.h3,{id:"further-documentation",children:"Further Documentation"}),"\n",(0,s.jsxs)(t.p,{children:["For more detailed instructions on using CodeQL, refer to the ",(0,s.jsx)(t.a,{href:"https://codeql.github.com/docs/",children:"official CodeQL documentation"}),"."]}),"\n",(0,s.jsx)(t.h2,{id:"-contributing",children:"\ud83e\udd1d Contributing"}),"\n",(0,s.jsx)(t.p,{children:"We welcome contributions to enhance and expand the support for Solidity in CodeQL. Feel free to submit issues, feature requests, or pull requests."}),"\n",(0,s.jsx)(t.h2,{id:"license",children:"License"}),"\n",(0,s.jsx)(t.p,{children:"The code in this repository is licensed under the MIT License by CoinFabrik."}),"\n",(0,s.jsxs)(t.p,{children:["For further information on CodeQL and CodeQL CLI licensing, please refer to the official ",(0,s.jsx)(t.a,{href:"https://github.com/github/codeql-cli-binaries",children:"repo"}),"."]})]})}function h(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},7226:(e,t,i)=>{i.d(t,{A:()=>s});const s=i.p+"assets/images/output-1649b3fc1ffdce14d0b6295e84a7b9aa.gif"},1503:(e,t,i)=>{i.d(t,{R:()=>r,x:()=>d});var s=i(758);const o={},n=s.createContext(o);function r(e){const t=s.useContext(n);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),s.createElement(n.Provider,{value:t},e.children)}}}]);